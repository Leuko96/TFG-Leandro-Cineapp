<div class="friends-layout">

  <!-- IZQUIERDA: Lista de amigos -->
  <div class="friends-section">
    <h2>Mis Amigos</h2>
    <div *ngIf="isLoading">
      <p>Cargando amigos...</p>
    </div>

    <div *ngIf="!isLoading && listFriends.length === 0" class="no-friends">
      <p>AÃºn no tienes amigos agregados ğŸ˜…</p>
    </div>

    <div class="friend-card"  *ngFor="let friend of listFriends">
      <div class="friend-info">
        <h3>{{friend['nombre']}}</h3>
        <p>{{friend['email']}}</p>
      </div>
        <div class="friend-actions">
        <button (click)="openChat(friend['id'], friend['nombre'], friend['avatar'], friend['isOnline'])" class="chat-btn">
          ğŸ’¬ Chat
        </button>
        <button (click)="deleteFriend(friend['id'])" class="remove-btn">
          Dejar de seguir
        </button>
      </div>
    </div>
  </div>

  <!-- Modal Chat -->
<div class="chat-modal" *ngIf="activeChatFriendId">
  <div class="chat-header">
    <div class="chat-header-info">
      <img *ngIf="activeChatFriendAvatar" [src]="activeChatFriendAvatar" alt="avatar" class="chat-avatar" />
      <div class="chat-header-text">
        <h3>{{ activeChatFriendName }}</h3>
        <span class="online-status" [class.online]="activeChatFriendOnline" [class.offline]="!activeChatFriendOnline" *ngIf="!activeChatFriendTyping">
          {{ activeChatFriendOnline ? 'â— En lÃ­nea' : 'â— Desconectado' }}
        </span>
        <span class="typing-indicator" *ngIf="activeChatFriendTyping">Escribiendo...</span>
      </div>
    </div>
    <button class="close-chat" (click)="closeChat()">âœ–</button>
  </div>

  <div class="chat-messages">
    <div *ngFor="let msg of chatMessages" [class.mine]="msg.senderId === usrUid " class="chat-message">
      <span class="chat-text">{{ msg.text }}</span>
      <div class="chat-footer">
        <small class="chat-date">{{ msg.createdAt | date:'short' }}</small>
        <span *ngIf="msg.senderId === usrUid" class="chat-tick" [class.read]="msg.read">
          {{ msg.read ? 'âœ“âœ“' : 'âœ“' }}
        </span>
      </div>
    </div>
  </div>

  <div class="chat-input">
    <input type="text" placeholder="EscribÃ­ un mensaje..." [(ngModel)]="messageText" (input)="onTyping()" />
    <button (click)="sendMessage()">Enviar</button>
  </div>
</div>

  <!-- DERECHA: Buscar y agregar -->
  <div class="add-section">
    <h2>Buscar Usuarios</h2>

    <form (ngSubmit)="searchUsers()" class="search-form">
      <input
        type="text"
        placeholder="Buscar por nombre..."
        [(ngModel)]="searchTerm"
        name="searchTerm"
      />
      <button type="submit">ğŸ” Buscar</button>
    </form>

    <div *ngIf="searchResults.length > 0" class="resultados">
      <h3>Resultados</h3>

      <div class="friend-card" *ngFor="let user of searchResults">
        <div class="friend-info">
          <h3>{{ user['nombre'] }}</h3>
          <p>{{ user['email'] }}</p>
        </div>
        <button (click)="agregarAmigo(user['id'])" class="add-btn">
          â• Agregar
        </button>
      </div>
    </div>
  </div>

</div>
